apiVersion: argoproj.io/v1alpha1
kind: Workflow
metadata:
  generateName: "spark-${{values.name}}-"
  namespace: "${{values.namespace}}"
  labels:
    backstage.io/component-id: "${{values.name}}"
spec:
  arguments: {}
  entrypoint: demo-workflow
  serviceAccountName: argo-workflows
  workflowMetadata:
    labels:
      backstage.io/component-id: "${{values.name}}"
  templates:
    - name: demo-workflow
      steps:
        - - name: sleep
            template: sleep
        - - name: spark-operator
            template: sparkapp
    - name: sleep
      container:
        image: docker/whalesay
        command: [ sleep ]
        args: [ "60" ]
    - name: sparkapp
      resource:
        action: create
        setOwnerReference: true
        successCondition: status.applicationState.state == COMPLETED
        failureCondition: status.applicationState.state in (FAILED, ERROR)
        manifest: |
          ${{values.manifest | dump}}
